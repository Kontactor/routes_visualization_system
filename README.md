# Transport Catalogue System

Полнофункциональная система управления транспортным каталогом с поддержкой маршрутизации, визуализации и JSON интерфейса.

## Особенности

- **Полный транспортный каталог** - управление остановками и маршрутами общественного транспорта
- **Расчет маршрутов** - поиск оптимальных путей с учетом времени ожидания и скорости транспорта
- **Визуализация карт** - генерация SVG-изображений транспортных сетей
- **Географические вычисления** - точный расчет расстояний на сфере Земли
- **JSON API** - полная поддержка JSON для ввода/вывода данных
- **Графовые алгоритмы** - эффективные алгоритмы поиска кратчайших путей

## Технологии и инструменты

- **Язык программирования**: C++17/20 (использование ranges, optional, variant)
- **Структуры данных**: 
  - Хэш-таблицы для быстрого поиска остановок и маршрутов
  - Графы для моделирования транспортной сети
  - Деревья и множества для сортировки и уникализации
- **Алгоритмы**:
  - Алгоритм Дейкстры для поиска кратчайших путей
  - Сферическая геометрия (формула гаверсинусов)
  - Проекция сферических координат на 2D плоскость
- **Визуализация**: SVG-рендеринг с поддержкой различных графических примитивов
- **Сериализация**: Полноценный JSON парсер и генератор
- **Архитектура**: Модульный дизайн с четким разделением ответственности

## Архитектура проекта

### Основные модули:

1. **`transport_catalogue`** - ядро системы, хранит данные об остановках и маршрутах
   - `TransportCatalogue` - основной класс каталога
   - Хранение остановок, маршрутов и расстояний между остановками

2. **`domain`** - бизнес-логика и структуры данных
   - `Stop`, `Route`, `RouteStats` - основные бизнес-объекты
   - `HasherPairPtr` - хэшер для пар указателей на остановки
   - `RouterSettings`, `RouteInfo` - настройки и информация о маршрутах

3. **`geo`** - географические вычисления
   - `Coordinates` - географические координаты
   - `ComputeDistance` - расчет расстояний на сфере

4. **`graph`** - графовые структуры и алгоритмы
   - `DirectedWeightedGraph` - взвешенный ориентированный граф
   - `Router` - алгоритмы поиска путей в графе

5. **`router`** - транспортная маршрутизация
   - `TransportRouter` - построение маршрутов общественного транспорта
   - Конвертация транспортной сети в граф

6. **`map_renderer`** - визуализация карт
   - `MapRenderer` - рендеринг SVG-карт
   - `SphereProjector` - проекция сферических координат на плоскость
   - `RenderSettings` - настройки визуализации

7. **`svg`** - SVG-генерация
   - `Document`, `Circle`, `Polyline`, `Text` - SVG-примитивы
   - `Color`, `Point` - базовые структуры для графики

8. **`json`** - JSON обработка
   - `Document`, `Node` - представление JSON-документов
   - `Builder` - флюентный интерфейс для построения JSON

9. **`json_reader`** - чтение и обработка JSON запросов
   - `JsonReader` - парсинг входных JSON данных
   - Генерация ответов в формате JSON

10. **`request_handler`** - обработка запросов
    - `RequestHandler` - координация работы всех компонентов системы
    - Связь между каталогом, рендерером и роутером

11. **`ranges`** - утилиты для работы с диапазонами
    - `Range`, `AsRange` - обертки для итераторов

### Ключевые структуры данных:

```cpp
struct Stop {
    std::string name;
    geo::Coordinates coordinates;
};

struct Route {
    std::string name;
    std::vector<Stop*> stops;
    bool is_roundtrip;
};

struct RouteStats {
    double geo_distance;      // Географическое расстояние
    size_t route_length;      // Фактическая длина маршрута
    size_t stops_count;       // Общее количество остановок
    size_t uniquestops_count; // Количество уникальных остановок
};
```

## Алгоритмы и оптимизации
### Географические вычисления:
* Формула гаверсинусов для точного расчета расстояний на сфере
* Проекция Меркатора для отображения на 2D плоскости
* Автоматическое масштабирование с сохранением пропорций

### Графовые алгоритмы:
* Моделирование транспортной сети как взвешенного ориентированного графа
* Двойные вершины для остановок (ожидание + поездка)
* Кэширование предвычисленных маршрутов для быстрого доступа

### Визуализация:
* Интеллектуальное размещение подписей маршрутов и остановок
* Циклическая палитра цветов для различных маршрутов
* Подложки для текста для улучшения читаемости

### Оптимизации производительности:
1. Хэш-таблицы для O(1) доступа к остановкам и маршрутам
2. Кэширование статистики маршрутов
3. Предварительное вычисление расстояний между остановками
4. Эффективные структуры данных для работы с графами

## Формат данных
### Входной JSON:
```json
{
  "base_requests": [
    {
      "type": "Stop",
      "name": "Электросети",
      "latitude": 43.587795,
      "longitude": 39.716901,
      "road_distances": {
        "Улица Димитрова": 4300
      }
    },
    {
      "type": "Bus",
      "name": "14",
      "stops": ["Улица Димитрова", "Электросети"],
      "is_roundtrip": false
    }
  ],
  "render_settings": {
    "width": 1200,
    "height": 1200,
    "padding": 50,
    "line_width": 14,
    "stop_radius": 5,
    "bus_label_font_size": 20,
    "bus_label_offset": [7, 15],
    "stop_label_font_size": 20,
    "stop_label_offset": [7, -3],
    "underlayer_color": [255, 255, 255, 0.85],
    "underlayer_width": 3,
    "color_palette": ["green", [255, 160, 0], "red"]
  },
  "routing_settings": {
    "bus_wait_time": 6,
    "bus_velocity": 40
  },
  "stat_requests": [
    {
      "id": 1,
      "type": "Bus",
      "name": "14"
    },
    {
      "id": 2,
      "type": "Route",
      "from": "Улица Димитрова",
      "to": "Электросети"
    }
  ]
}
```

### Выходной JSON:

```json
[
  {
    "request_id": 1,
    "curvature": 1.43023,
    "route_length": 4300,
    "stop_count": 3,
    "unique_stop_count": 2
  },
  {
    "request_id": 2,
    "total_time": 12.483,
    "items": [
      {
        "type": "Wait",
        "stop_name": "Улица Димитрова",
        "time": 6
      },
      {
        "type": "Bus",
        "bus": "14",
        "span_count": 1,
        "time": 6.483
      }
    ]
  }
]
```